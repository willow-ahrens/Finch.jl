<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Index Sugar · Finch.jl</title><meta name="title" content="Index Sugar · Finch.jl"/><meta property="og:title" content="Index Sugar · Finch.jl"/><meta property="twitter:title" content="Index Sugar · Finch.jl"/><meta name="description" content="Documentation for Finch.jl."/><meta property="og:description" content="Documentation for Finch.jl."/><meta property="twitter:description" content="Documentation for Finch.jl."/><meta property="og:url" content="https://willow-ahrens.github.io/Finch.jl/guides/index_sugar/"/><meta property="twitter:url" content="https://willow-ahrens.github.io/Finch.jl/guides/index_sugar/"/><link rel="canonical" href="https://willow-ahrens.github.io/Finch.jl/guides/index_sugar/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Finch.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Finch.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Comprehensive Guides</span><ul><li><a class="tocitem" href="../calling_finch/">Calling Finch</a></li><li><a class="tocitem" href="../tensor_formats/">Tensor Formats</a></li><li><a class="tocitem" href="../sparse_utils/">Sparse and Structured Utilities</a></li><li><a class="tocitem" href="../finch_language/">The Finch Language</a></li><li><a class="tocitem" href="../dimensionalization/">Dimensionalization</a></li><li class="is-active"><a class="tocitem" href>Index Sugar</a></li><li><a class="tocitem" href="../mask_sugar/">Mask Sugar</a></li><li><a class="tocitem" href="../iteration_protocols/">Iteration Protocols</a></li><li><a class="tocitem" href="../custom_operators/">Custom Operators</a></li><li><a class="tocitem" href="../array_api/">High-Level Array API</a></li><li><a class="tocitem" href="../fileio/">FileIO</a></li><li><a class="tocitem" href="../interoperability/">Interoperability</a></li><li><a class="tocitem" href="../optimization_tips/">Optimization Tips</a></li><li><a class="tocitem" href="../benchmarking_tips/">Benchmarking Tips</a></li></ul></li><li><span class="tocitem">Technical Reference</span><ul><li><a class="tocitem" href="../../reference/listing/">Documentation Listing</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Advanced Implementation Details</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/advanced_implementation/internals/">Internals</a></li><li><a class="tocitem" href="../../reference/advanced_implementation/tensor_interface/">Tensor Interface</a></li></ul></li></ul></li><li><a class="tocitem" href="../../CONTRIBUTING/">Community and Contributions</a></li><li><span class="tocitem">Appendices and Additional Resources</span><ul><li><a class="tocitem" href="../../appendices/directory_structure/">Directory Structure</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Comprehensive Guides</a></li><li class="is-active"><a href>Index Sugar</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Index Sugar</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/willow-ahrens/Finch.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/willow-ahrens/Finch.jl/blob/main/docs/src/guides/index_sugar.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Index-Sugar-and-Tensor-Modifiers"><a class="docs-heading-anchor" href="#Index-Sugar-and-Tensor-Modifiers">Index Sugar and Tensor Modifiers</a><a id="Index-Sugar-and-Tensor-Modifiers-1"></a><a class="docs-heading-anchor-permalink" href="#Index-Sugar-and-Tensor-Modifiers" title="Permalink"></a></h1><p>In Finch, expressions like <code>x[i + 1]</code> are compiled using tensor modifiers, like <code>offset(x, 1)[i]</code>. The user can construct tensor modifiers directly, e.g. <code>offset(x, 1)</code>, or implicitly using the syntax <code>x[i + 1]</code>. Recognizable index expressions are converted to tensor modifiers before dimensionalization, so that the modified tensor will participate in dimensionalization.</p><p>While tensor modifiers may change the behavior of a tensor, they reference their parent tensor as the <code>root</code> tensor. Modified tensors are not understoond as distinct from their roots. For example, all accesses to the root tensor must obey lifecycle and dimensionalization rules. Additionally, root tensors which are themselves modifiers are unwrapped at the beginning of the program, so that modifiers are not obscured and the new root tensor is not a modifier.</p><p>The following table lists the recognized index expressions and their equivalent tensor expressions, where <code>i</code> is an index, <code>a, b</code> are constants, <code>p</code> is an iteration protocol, and <code>x</code> is an expression:</p><table><tr><th style="text-align: right">Original Expression</th><th style="text-align: right">Transformed Expression</th></tr><tr><td style="text-align: right"><code>A[i + a]</code></td><td style="text-align: right"><code>offset(A, 1)[i]</code></td></tr><tr><td style="text-align: right"><code>A[i + x]</code></td><td style="text-align: right"><code>toeplitz(A, 1)[i, x]</code></td></tr><tr><td style="text-align: right"><code>A[(a:b)(i)]</code></td><td style="text-align: right"><code>window(A, a:b)[i]</code></td></tr><tr><td style="text-align: right"><code>A[a * i]</code></td><td style="text-align: right"><code>scale(A, (3,))[i]</code></td></tr><tr><td style="text-align: right"><code>A[i * x]</code></td><td style="text-align: right"><code>products(A, 1)[i, j]</code></td></tr><tr><td style="text-align: right"><code>A[~i]</code></td><td style="text-align: right"><code>permissive(A)[i]</code></td></tr><tr><td style="text-align: right"><code>A[p(i)]</code></td><td style="text-align: right"><code>protocolize(A, p)[i]</code></td></tr></table><p>Each of these tensor modifiers is described below:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.offset" href="#Finch.offset"><code>Finch.offset</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">offset(tns, delta...)</code></pre><p>Create an <code>OffsetArray</code> such that <code>offset(tns, delta...)[i...] == tns[i .+ delta...]</code>. The dimensions declared by an OffsetArray are shifted, so that <code>size(offset(tns, delta...)) == size(tns) .+ delta</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/offset.jl#L37-L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.toeplitz" href="#Finch.toeplitz"><code>Finch.toeplitz</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">toeplitz(tns, dim)</code></pre><p>Create a <code>ToeplitzArray</code> such that</p><pre><code class="nohighlight hljs">    Toeplitz(tns, dim)[i...] == tns[i[1:dim-1]..., i[dim] + i[dim + 1], i[dim + 2:end]...]</code></pre><p>The ToplitzArray can be thought of as adding a dimension that shifts another dimension of the original tensor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/toeplitz.jl#L46-L54">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.window" href="#Finch.window"><code>Finch.window</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">window(tns, dims)</code></pre><p>Create a <code>WindowedArray</code> which represents a view into another tensor</p><pre><code class="nohighlight hljs">    window(tns, dims)[i...] == tns[dim[1][i], dim[2][i], ...]</code></pre><p>The windowed array restricts the new dimension to the dimension of valid indices of each <code>dim</code>. The <code>dims</code> may also be <code>nothing</code> to represent a full view of the underlying dimension.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/windowed.jl#L41-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.scale" href="#Finch.scale"><code>Finch.scale</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">scale(tns, delta...)</code></pre><p>Create a <code>ScaleArray</code> such that <code>scale(tns, delta...)[i...] == tns[i .* delta...]</code>.  The dimensions declared by an OffsetArray are shifted, so that <code>size(scale(tns, delta...)) == size(tns) .* delta</code>.  This is only supported on tensors with real-valued dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/scale.jl#L37-L44">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.products" href="#Finch.products"><code>Finch.products</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">products(tns, dim)</code></pre><p>Create a <code>ProductArray</code> such that</p><pre><code class="nohighlight hljs">    products(tns, dim)[i...] == tns[i[1:dim-1]..., i[dim] * i[dim + 1], i[dim + 2:end]...]</code></pre><p>This is like <a href="#Finch.toeplitz"><code>toeplitz</code></a> but with times instead of plus.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/product.jl#L43-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.permissive" href="#Finch.permissive"><code>Finch.permissive</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">permissive(tns, dims...)</code></pre><p>Create an <code>PermissiveArray</code> where <code>permissive(tns, dims...)[i...]</code> is <code>missing</code> if <code>i[n]</code> is not in the bounds of <code>tns</code> when <code>dims[n]</code> is <code>true</code>.  This wrapper allows all permissive dimensions to be exempt from dimension checks, and is useful when we need to access an array out of bounds, or for padding. More formally,</p><pre><code class="nohighlight hljs">    permissive(tns, dims...)[i...] =
        if any(n -&gt; dims[n] &amp;&amp; !(i[n] in axes(tns)[n]))
            missing
        else
            tns[i...]
        end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/permissive.jl#L36-L52">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Finch.protocolize" href="#Finch.protocolize"><code>Finch.protocolize</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">protocolize(tns, protos...)</code></pre><p>Create a <code>ProtocolizedArray</code> that accesses dimension <code>n</code> with protocol <code>protos[n]</code>, if <code>protos[n]</code> is not nothing. See the documention for <a href="../iteration_protocols/#Iteration-Protocols">Iteration Protocols</a> for more information. For example, to gallop along the inner dimension of a matrix <code>A</code>, we write <code>A[gallop(i), j]</code>, which becomes <code>protocolize(A, gallop, nothing)[i, j]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/willow-ahrens/Finch.jl/blob/e72147109064936efd1e4b2218bee0ac8d1d68e1/src/tensors/combinators/protocolized.jl#L39-L47">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dimensionalization/">« Dimensionalization</a><a class="docs-footer-nextpage" href="../mask_sugar/">Mask Sugar »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Friday 10 May 2024 19:58">Friday 10 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
